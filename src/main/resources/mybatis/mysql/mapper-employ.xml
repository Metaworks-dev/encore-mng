<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="employ">

	<select id="getEmpList" parameterType="hashmap" resultType="hashmap">
		SELECT /* employ.getEmpList */
		       EMP_ID, EMP_NO, EMAIL, PASSWD, EMP_NM, MNG_LVL, ENT_DT, REG_DTM, MOD_DTM
		  FROM TB_EMP
		 WHERE 1 = 1
		<if test="EMP_ID != null">
		   AND EMP_ID = #{EMP_ID}
		</if>
		<if test="EMP_NM != null">
			AND EMP_NM LIKE CONCAT('%', #{EMP_NM}, '%')
		</if>
		<if test="EMAIL != null">
			AND EMAIL = #{EMAIL}
		    AND PASSWD = #{PASSWD}
		</if>
         ORDER BY EMP_ID DESC
		<if test="start != null">
		limit #{start}, #{limit}
		</if>
	</select>

	<select id="getEmpListCnt" parameterType="hashmap" resultType="int">
		SELECT /* employ.getEmpListCnt */
		COUNT(*)
		FROM TB_EMP
		WHERE 1 = 1
		<if test="EMP_ID != null">
			AND EMP_ID = #{EMP_ID}
		</if>
		<if test="EMAIL != null">
			AND EMAIL = #{EMAIL}
			AND PASSWD = #{PASSWD}
		</if>
	</select>

	<insert id="insertEmp" parameterType="hashmap">
		INSERT /* employ.insertEmp */
		  INTO TB_EMP
			(EMP_NO, EMAIL, PASSWD, EMP_NM, MNG_LVL, ENT_DT, REG_DTM, MOD_DTM)
		VALUES
			(#{EMP_NO}, #{EMAIL}, #{PASSWD}, #{EMP_NM}, #{MNG_LVL}, #{ENT_DT}, NOW(), NOW())
	</insert>
	
	<update id="updateEmp" parameterType="hashmap">
		UPDATE /* employ.updateEmp */
			   TB_EMP
		   SET EMAIL = IFNULL(#{EMAIL}, EMAIL)
		      ,PASSWD = IFNULL(#{PASSWD}, PASSWD)
		      ,EMP_NM = IFNULL(#{EMP_NM}, EMP_NM)
		      ,EMP_NO = IFNULL(#{EMP_NO}, EMP_NO)
		      ,MNG_LVL = IFNULL(#{MNG_LVL}, MNG_LVL)
			  ,ENT_DT = IFNULL(#{ENT_DT}, ENT_DT)
		      ,MOD_DTM = NOW()
		 WHERE 1 = 1
		   AND EMP_ID = #{EMP_ID}
	</update>

	<delete id="deleteEmp" parameterType="hashmap">
		DELETE /* employ.deleteEmp */
			   TB_EMP
		 WHERE 1 = 1
		   AND EMP_ID = #{EMP_ID}
	</delete>

	<select id="getEmpCalendarList" parameterType="hashmap" resultType="int">
		SELECT /* employ.getEmpCalendarList */ A.YYYY_MM
			 ,B.PROJ_ID
			 ,C.PROJ_NM
			 ,COUNT(*) DD
			 ,MAX(CASE WHEN A.DD = '01' AND B.WORK_DT IS NOT NULL THEN 1 END) D01
			 ,MAX(CASE WHEN A.DD = '02' AND B.WORK_DT IS NOT NULL THEN 1 END) D02
			 ,MAX(CASE WHEN A.DD = '03' AND B.WORK_DT IS NOT NULL THEN 1 END) D03
			 ,MAX(CASE WHEN A.DD = '04' AND B.WORK_DT IS NOT NULL THEN 1 END) D04
			 ,MAX(CASE WHEN A.DD = '05' AND B.WORK_DT IS NOT NULL THEN 1 END) D05
			 ,MAX(CASE WHEN A.DD = '06' AND B.WORK_DT IS NOT NULL THEN 1 END) D06
			 ,MAX(CASE WHEN A.DD = '07' AND B.WORK_DT IS NOT NULL THEN 1 END) D07
			 ,MAX(CASE WHEN A.DD = '08' AND B.WORK_DT IS NOT NULL THEN 1 END) D08
			 ,MAX(CASE WHEN A.DD = '09' AND B.WORK_DT IS NOT NULL THEN 1 END) D09
			 ,MAX(CASE WHEN A.DD = '10' AND B.WORK_DT IS NOT NULL THEN 1 END) D10
			 ,MAX(CASE WHEN A.DD = '11' AND B.WORK_DT IS NOT NULL THEN 1 END) D11
			 ,MAX(CASE WHEN A.DD = '12' AND B.WORK_DT IS NOT NULL THEN 1 END) D12
			 ,MAX(CASE WHEN A.DD = '13' AND B.WORK_DT IS NOT NULL THEN 1 END) D13
			 ,MAX(CASE WHEN A.DD = '14' AND B.WORK_DT IS NOT NULL THEN 1 END) D14
			 ,MAX(CASE WHEN A.DD = '15' AND B.WORK_DT IS NOT NULL THEN 1 END) D15
			 ,MAX(CASE WHEN A.DD = '16' AND B.WORK_DT IS NOT NULL THEN 1 END) D16
			 ,MAX(CASE WHEN A.DD = '17' AND B.WORK_DT IS NOT NULL THEN 1 END) D17
			 ,MAX(CASE WHEN A.DD = '18' AND B.WORK_DT IS NOT NULL THEN 1 END) D18
			 ,MAX(CASE WHEN A.DD = '19' AND B.WORK_DT IS NOT NULL THEN 1 END) D19
			 ,MAX(CASE WHEN A.DD = '20' AND B.WORK_DT IS NOT NULL THEN 1 END) D20
			 ,MAX(CASE WHEN A.DD = '21' AND B.WORK_DT IS NOT NULL THEN 1 END) D21
			 ,MAX(CASE WHEN A.DD = '22' AND B.WORK_DT IS NOT NULL THEN 1 END) D22
			 ,MAX(CASE WHEN A.DD = '23' AND B.WORK_DT IS NOT NULL THEN 1 END) D23
			 ,MAX(CASE WHEN A.DD = '24' AND B.WORK_DT IS NOT NULL THEN 1 END) D24
			 ,MAX(CASE WHEN A.DD = '25' AND B.WORK_DT IS NOT NULL THEN 1 END) D25
			 ,MAX(CASE WHEN A.DD = '26' AND B.WORK_DT IS NOT NULL THEN 1 END) D26
			 ,MAX(CASE WHEN A.DD = '27' AND B.WORK_DT IS NOT NULL THEN 1 END) D27
			 ,MAX(CASE WHEN A.DD = '28' AND B.WORK_DT IS NOT NULL THEN 1 END) D28
			 ,MAX(CASE WHEN A.DD = '29' AND B.WORK_DT IS NOT NULL THEN 1 END) D29
			 ,MAX(CASE WHEN A.DD = '30' AND B.WORK_DT IS NOT NULL THEN 1 END) D30
			 ,MAX(CASE WHEN A.DD = '31' AND B.WORK_DT IS NOT NULL THEN 1 END) D31
			 ,MAX(CASE WHEN A.DD = '01' AND A.HOLIDAY_YN = 1 THEN 1 END) H01
			 ,MAX(CASE WHEN A.DD = '02' AND A.HOLIDAY_YN = 1 THEN 1 END) H02
			 ,MAX(CASE WHEN A.DD = '03' AND A.HOLIDAY_YN = 1 THEN 1 END) H03
			 ,MAX(CASE WHEN A.DD = '04' AND A.HOLIDAY_YN = 1 THEN 1 END) H04
			 ,MAX(CASE WHEN A.DD = '05' AND A.HOLIDAY_YN = 1 THEN 1 END) H05
			 ,MAX(CASE WHEN A.DD = '06' AND A.HOLIDAY_YN = 1 THEN 1 END) H06
			 ,MAX(CASE WHEN A.DD = '07' AND A.HOLIDAY_YN = 1 THEN 1 END) H07
			 ,MAX(CASE WHEN A.DD = '08' AND A.HOLIDAY_YN = 1 THEN 1 END) H08
			 ,MAX(CASE WHEN A.DD = '09' AND A.HOLIDAY_YN = 1 THEN 1 END) H09
			 ,MAX(CASE WHEN A.DD = '10' AND A.HOLIDAY_YN = 1 THEN 1 END) H10
			 ,MAX(CASE WHEN A.DD = '11' AND A.HOLIDAY_YN = 1 THEN 1 END) H11
			 ,MAX(CASE WHEN A.DD = '12' AND A.HOLIDAY_YN = 1 THEN 1 END) H12
			 ,MAX(CASE WHEN A.DD = '13' AND A.HOLIDAY_YN = 1 THEN 1 END) H13
			 ,MAX(CASE WHEN A.DD = '14' AND A.HOLIDAY_YN = 1 THEN 1 END) H14
			 ,MAX(CASE WHEN A.DD = '15' AND A.HOLIDAY_YN = 1 THEN 1 END) H15
			 ,MAX(CASE WHEN A.DD = '16' AND A.HOLIDAY_YN = 1 THEN 1 END) H16
			 ,MAX(CASE WHEN A.DD = '17' AND A.HOLIDAY_YN = 1 THEN 1 END) H17
			 ,MAX(CASE WHEN A.DD = '18' AND A.HOLIDAY_YN = 1 THEN 1 END) H18
			 ,MAX(CASE WHEN A.DD = '19' AND A.HOLIDAY_YN = 1 THEN 1 END) H19
			 ,MAX(CASE WHEN A.DD = '20' AND A.HOLIDAY_YN = 1 THEN 1 END) H20
			 ,MAX(CASE WHEN A.DD = '21' AND A.HOLIDAY_YN = 1 THEN 1 END) H21
			 ,MAX(CASE WHEN A.DD = '22' AND A.HOLIDAY_YN = 1 THEN 1 END) H22
			 ,MAX(CASE WHEN A.DD = '23' AND A.HOLIDAY_YN = 1 THEN 1 END) H23
			 ,MAX(CASE WHEN A.DD = '24' AND A.HOLIDAY_YN = 1 THEN 1 END) H24
			 ,MAX(CASE WHEN A.DD = '25' AND A.HOLIDAY_YN = 1 THEN 1 END) H25
			 ,MAX(CASE WHEN A.DD = '26' AND A.HOLIDAY_YN = 1 THEN 1 END) H26
			 ,MAX(CASE WHEN A.DD = '27' AND A.HOLIDAY_YN = 1 THEN 1 END) H27
			 ,MAX(CASE WHEN A.DD = '28' AND A.HOLIDAY_YN = 1 THEN 1 END) H28
			 ,MAX(CASE WHEN A.DD = '29' AND A.HOLIDAY_YN = 1 THEN 1 END) H29
			 ,MAX(CASE WHEN A.DD = '30' AND A.HOLIDAY_YN = 1 THEN 1 END) H30
			 ,MAX(CASE WHEN A.DD = '31' AND A.HOLIDAY_YN = 1 THEN 1 END) H31
		FROM TB_CALENDAR A
				 LEFT OUTER JOIN TB_PROJ_WORK B ON A.YYYY_MM_DD = B.WORK_DT AND B.EMP_ID = 1
				 LEFT OUTER JOIN TB_PROJ C ON B.PROJ_ID = C.PROJ_ID
		WHERE 1 = 1
		  AND YYYY_MM LIKE CONCAT(DATE_FORMAT(NOW(), '%Y'), '%')
		GROUP BY YYYY_MM, B.PROJ_ID ,C.PROJ_NM
	</select>
</mapper>


